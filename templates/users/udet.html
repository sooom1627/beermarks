{% extends 'base.html' %}
{% block content %}
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-md-12">
        <div class="iq-card">
          <div class="iq-card-body profile-page">
            <div class="profile-header">
              <div class="cover-container row py-3">
                <div class="col-md-6">
                  <div class="text-center">
                    <img src="{{ object.upic.url }}" alt="profile-bg" class="rounded-circle img-fluid" style="width: 150px; height:150px; object-fit:cover;"/>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="profile-detail mt-3">
                    <h3>{{ object.uname }}</h3>
                    <p>
                      {{ object.udesc }}
                    </p>
                    {% comment %} <div class="iq-social d-inline-block align-items-center text-center mt-3">
                      <ul class="list-inline d-flex p-0 mb-0 align-items-center">
                        <li>
                          <a href="#" class="avatar-40 rounded-circle bg-primary mr-2 facebook">
                            <i class="fa fa-facebook" aria-hidden="true"></i>
                          </a>
                        </li>
                        <li>
                          <a href="#" class="avatar-40 rounded-circle bg-primary mr-2 twitter">
                            <i class="fa fa-twitter" aria-hidden="true"></i>
                          </a>
                        </li>
                        <li>
                          <a href="#" class="avatar-40 rounded-circle bg-primary mr-2 youtube">
                            <i class="fa fa-youtube-play" aria-hidden="true"></i>
                          </a>
                        </li>
                        <li>
                          <a href="#" class="avatar-40 rounded-circle bg-primary pinterest">
                            <i class="fa fa-pinterest-p" aria-hidden="true"></i>
                          </a>
                        </li>
                      </ul>
                    </div> {% endcomment %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="iq-card-body">
          <ul class="nav nav-tabs" id="myTab-two" role="tablist">
            <li class="nav-item">
              <a class="nav-link active px-2" id="sum-tab-two" data-toggle="tab" href="#sum-two" role="tab" aria-controls="profile" aria-selected="false" style="font-size:14px">サマリ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-2" id="profile-tab-two" data-toggle="tab" href="#profile-two" role="tab" aria-controls="profile" aria-selected="false" style="font-size:14px">飲んだ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-2" id="home-tab-two" data-toggle="tab" href="#home-two" role="tab" aria-controls="home" aria-selected="true" style="font-size:14px">飲みたい</a>
            </li>
            <li class="nav-item">
              <a class="nav-link px-2" id="brand-tab-two" data-toggle="tab" href="#brand-two" role="tab" aria-controls="brand" aria-selected="false" style="font-size:14px">ブルワリー</a>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent-1">
            <div class="tab-pane fade active show" id="sum-two" role="tabpanel" aria-labelledby="sum-tab-two">
              <div class="row align-items-center">
                <div class="col-12 col-md-4 col-lg-4">
                  <div class="iq-card iq-card-block iq-card-stretch iq-card-height mb-3">
                    <div class="iq-card-body">
                      <div class="d-flex align-items-center justify-content-between">
                        <h6>レビュー</h6>
                      </div>
                      <div class="
                                  iq-customer-box
                                  d-flex
                                  align-items-center
                                  justify-content-between
                                ">
                        <div class="iq-map text-success font-size-32">
                          <i class="ri-bar-chart-grouped-line"></i>
                        </div>
                        <div class="d-flex align-items-center">
                          <h2>{{ drunks.count }}</h2>
                          <div class="rounded-circle iq-card-icon iq-bg-success ml-3">
                            <i class="las la-comment"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="iq-card iq-card-block iq-card-stretch iq-card-height mb-3">
                    <div class="iq-card-body">
                      <div class="d-flex align-items-center justify-content-between">
                        <h6>飲みたい！</h6>
                      </div>
                      <div class="
                                  iq-customer-box
                                  d-flex
                                  align-items-center
                                  justify-content-between
                                ">
                        <div class="iq-map text-primary font-size-32">
                          <i class="ri-bar-chart-grouped-line"></i>
                        </div>
                        <div class="d-flex align-items-center">
                          <h2>{{ faved.count }}</h2>
                          <div class="rounded-circle iq-card-icon iq-bg-primary ml-3">
                            <i class="ri-heart-fill text-primary"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="iq-card iq-card-block iq-card-stretch iq-card-height mb-3">
                    <div class="iq-card-body">
                      <div class="d-flex align-items-center justify-content-between">
                        <h6>ブルワリー</h6>
                      </div>
                      <div class="
                                  iq-customer-box
                                  d-flex
                                  align-items-center
                                  justify-content-between
                                ">
                        <div class="iq-map text-info font-size-32">
                          <i class="ri-bar-chart-grouped-line"></i>
                        </div>
                        <div class="d-flex align-items-center">
                          <h2>{{ faved_b.count }}</h2>
                          <div class="rounded-circle iq-card-icon iq-bg-info ml-3">
                            <i class="las la-campground"></i>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-8 col-md-8 col-12">
                  <div class="iq-card iq-card-block iq-card-stretch iq-card-height justify-content-center" style="padding: 20px 0px 5px 22px;">
                    <div id="chart"></div>
                  </div>
                  <input type="hidden" id="data" name="data" value="{{ dic }}">
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="home-two" role="tabpanel" aria-labelledby="home-tab-two">
              <div class="iq-card-body">
                <ul class="list-unstyled row iq-box-hover mb-0">
                  {% for item in faved_list %}
                    <li class="col-xl-3 col-lg-4 col-md-5 iq-music-box">
                      <div class="iq-card">
                        <div class="iq-card-body p-0">
                          <div class="iq-thumb d-flex align-items-center justify-content-center">
                            <a href="detail.html">
                              <img src="{{ item.product.ppic.url }}" class="img-border-radius img-fluid" style="object-fit:cover;height:230px;" alt=""/>
                            </a>
                          </div>
                          <div class="feature-list text-center">
                            <a href="{% url 'detail' item.product.pk %}">
                              <h6 class="font-weight-600 mb-0">
                                {{ item.product.pname }}
                              </h6>
                            </a>
                            <a href="#">
                              <small class="mb-0">{{ item.product.brand }}</small>
                            </a>
                          </div>
                        </div>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="tab-pane fade" id="profile-two" role="tabpanel" aria-labelledby="profile-tab-two">
              <div class="iq-card-body">
                <ul class="list-unstyled row iq-box-hover mb-0">
                  {% for item in drunk_list %}
                    <li class="col-xl-3 col-lg-4 col-md-5 iq-music-box">
                      <div class="iq-card">
                        <div class="iq-card-body p-0">
                          <div class="iq-thumb d-flex align-items-center justify-content-center">
                            <a href="detail.html">
                              <img src="{{ item.product.ppic.url }}" class="img-border-radius img-fluid" style="object-fit:cover;height:230px;" alt=""/>
                            </a>
                          </div>
                          <div class="feature-list text-center">
                            <a href="{% url 'detail' item.product.pk %}">
                              <h6 class="font-weight-600 mb-0">
                                {{ item.product.pname }}
                              </h6>
                            </a>
                            <a href="#">
                              <small class="mb-0">{{ item.product.brand }}</small>
                            </a>
                          </div>
                        </div>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="tab-pane fade" id="brand-two" role="tabpanel" aria-labelledby="brand-tab-two">
              <div class="iq-card-body">
                <ul class="list-unstyled row iq-box-hover mb-0">
                  {% for item in faved_b_list %}
                    <li class="col-xl-3 col-lg-4 col-md-5 iq-music-box">
                      <div class="iq-card">
                        <div class="iq-card-body p-0">
                          <div class="iq-thumb">
                            <a href="{% url 'branddetail' item.brand.pk %}">
                              <img src="{{ item.brand.bpic.url }}" class="img-border-radius img-fluid w-100" style="width:100%;height:160px;" alt=""/>
                            </a>
                          </div>
                          <div class="feature-list text-center">
                            <a href="{% url 'branddetail' item.brand.pk %}">
                              <h6 class="font-weight-600 mb-0">
                                {{ item.brand.bname }}
                              </h6>
                            </a>
                          </div>
                        </div>
                      </div>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- <div class="col-12 col-md-12 col-lg-8"></div> -->
    </div>
  </div>
{% endblock content %}
{% block ext_js %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script>
    const typesData = document
      .getElementById("data")
      .value;
    const typeData = JSON.parse(typesData);
    const options = {
      series: [
        {
          data: typeData
        }
      ],
      legend: {
        show: false
      },
      chart: {
        height: 400,
        type: 'treemap'
      },
      title: {
        text: '飲んだビール',
        align: 'center'
      },
      dataLabels: {
        enabled: true,
        style: {
          fontSize: '12px'
        },
        formatter: function (text, op) {
          return [text, op.value]
        },
        offsetY: -4
      },
      colors: [
        '#FF4545',
        '#20E2AB',
        '#FF7751',
        '#FFDD31',
        '#00D0FF',
        '#00D871',
        '#F35F3B',
        '#FA7C03',
        '#421243',
        '#7F94B0',
        '#EF6537',
        '#C0ADDB'
      ],
      plotOptions: {
        treemap: {
          distributed: true,
          enableShades: false
        }
      }
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
  </script>
  <script type="text/javascript">
    $(document).ready(function (event) {
      $(document).on('click', '#favp', function (event) {
        event.preventDefault();
        $.ajax({
          headers: {
            'X-CSRFToken': csrftoken
          },
          type: 'POST',
          url: "{% url 'favp' %}",
          data: {
            'product_id': $(this).attr('name')
          },
          dataType: 'json',
          success: function (response) {
            selector = document.getElementsByName(response.product_id);
            if (response.faved) {
              $(selector).html("<i class='fas fa-lg fa-heart'></i>");
            } else {
              $(selector).html("<i class='far fa-lg fa-heart'></i>");
            }
            selector2 = document.getElementsByName(response.product_id + "-count");
            $(selector2).text(response.count);
          }
        });
      });
    });
  </script>
{% endblock ext_js %}